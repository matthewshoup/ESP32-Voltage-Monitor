esphome:
  name: esp32_voltage_monitor
  friendly_name: ESP32 Voltage Monitor

esp32:
  board: esp32-c3-devkitm-1
  variant: esp32c3
  framework:
    type: arduino

wifi:
  ssid: "YOUR_WIFI_SSID"
  password: "YOUR_WIFI_PASSWORD"

  ap:
    ssid: "ESP32 Voltage Monitor Fallback"
    password: "changeme123"

captive_portal:

logger:

api:

ota:
  password: "CHANGE_ME_OTA_PASSWORD"

# Relay output
output:
  - platform: gpio
    pin: GPIO0
    id: relay_output

switch:
  - platform: output
    name: "Relay"
    id: relay_switch
    output: relay_output
    restore_mode: ALWAYS_ON

# I2C for SSD1306 OLED
i2c:
  sda: 5
  scl: 6

# ADC voltage measurement (GPIO34)
sensor:
  - platform: adc
    pin: GPIO4
    name: "Battery Voltage"
    id: battery_voltage
    attenuation: 11db
    update_interval: 2s
    filters:
      - multiply: 11.0  # R1=100k, R2=10k => (R1+R2)/R2 = 11
    on_value_range:
      - below: 15.6
        then:
          - switch.turn_off: relay_switch
      - above: 16.1
        then:
          - switch.turn_on: relay_switch

# Low voltage alert thresholds
binary_sensor:
  - platform: template
    name: "Low Voltage"
    lambda: |-
      return id(battery_voltage).state <= 16.8;
    update_interval: 2s

# OLED display
font:
  - file: "gfonts://Roboto"
    id: font_small
    size: 12
  - file: "gfonts://Roboto"
    id: font_large
    size: 18

display:
  - platform: ssd1306_i2c
    model: "SSD1306 72x40"
    address: 0x3C
    lambda: |-
      it.printf(0, 0, id(font_small), "Battery");
      it.printf(0, 12, id(font_large), "%.2fV", id(battery_voltage).state);
      if (id(battery_voltage).state <= 15.6) {
        it.printf(0, 28, id(font_small), "LOW VOLT");
      } else if (id(battery_voltage).state <= 16.4) {
        it.printf(0, 28, id(font_small), "WARNING");
      } else {
        it.printf(0, 28, id(font_small), "STATUS OK");
      }
